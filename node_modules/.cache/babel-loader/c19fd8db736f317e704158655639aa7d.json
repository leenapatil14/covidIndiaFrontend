{"ast":null,"code":"'use strict';\n\nmodule.exports = createSelectBuffer;\n\nvar createFBO = require('gl-fbo');\n\nvar pool = require('typedarray-pool');\n\nvar ndarray = require('ndarray');\n\nvar cwise = require('cwise');\n\nvar nextPow2 = require('bit-twiddle').nextPow2;\n\nvar selectRange = cwise({\n  args: ['array', {\n    'offset': [0, 0, 1],\n    'array': 0\n  }, {\n    'offset': [0, 0, 2],\n    'array': 0\n  }, {\n    'offset': [0, 0, 3],\n    'array': 0\n  }, 'scalar', 'scalar', 'index'],\n  pre: function () {\n    this.closestD2 = 1e8;\n    this.closestX = -1;\n    this.closestY = -1;\n  },\n  body: function (r, g, b, a, x, y, idx) {\n    if (r < 255 || g < 255 || b < 255 || a < 255) {\n      var dx = x - idx[0];\n      var dy = y - idx[1];\n      var d2 = dx * dx + dy * dy;\n\n      if (d2 < this.closestD2) {\n        this.closestD2 = d2;\n        this.closestX = idx[0];\n        this.closestY = idx[1];\n      }\n    }\n  },\n  post: function () {\n    return [this.closestX, this.closestY, this.closestD2];\n  }\n});\n\nfunction SelectResult(x, y, id, value, distance) {\n  this.coord = [x, y];\n  this.id = id;\n  this.value = value;\n  this.distance = distance;\n}\n\nfunction SelectBuffer(gl, fbo, buffer) {\n  this.gl = gl;\n  this.fbo = fbo;\n  this.buffer = buffer;\n  this._readTimeout = null;\n  var self = this;\n\n  this._readCallback = function () {\n    if (!self.gl) {\n      return;\n    }\n\n    fbo.bind();\n    gl.readPixels(0, 0, fbo.shape[0], fbo.shape[1], gl.RGBA, gl.UNSIGNED_BYTE, self.buffer);\n    self._readTimeout = null;\n  };\n}\n\nvar proto = SelectBuffer.prototype;\nObject.defineProperty(proto, 'shape', {\n  get: function () {\n    if (!this.gl) {\n      return [0, 0];\n    }\n\n    return this.fbo.shape.slice();\n  },\n  set: function (v) {\n    if (!this.gl) {\n      return;\n    }\n\n    this.fbo.shape = v;\n    var c = this.fbo.shape[0];\n    var r = this.fbo.shape[1];\n\n    if (r * c * 4 > this.buffer.length) {\n      pool.free(this.buffer);\n      var buffer = this.buffer = pool.mallocUint8(nextPow2(r * c * 4));\n\n      for (var i = 0; i < r * c * 4; ++i) {\n        buffer[i] = 0xff;\n      }\n    }\n\n    return v;\n  }\n});\n\nproto.begin = function () {\n  var gl = this.gl;\n  var shape = this.shape;\n\n  if (!gl) {\n    return;\n  }\n\n  this.fbo.bind();\n  gl.clearColor(1, 1, 1, 1);\n  gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n};\n\nproto.end = function () {\n  var gl = this.gl;\n\n  if (!gl) {\n    return;\n  }\n\n  gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n  if (!this._readTimeout) {\n    clearTimeout(this._readTimeout);\n  }\n\n  this._readTimeout = setTimeout(this._readCallback, 1);\n};\n\nproto.query = function (x, y, radius) {\n  if (!this.gl) {\n    return null;\n  }\n\n  var shape = this.fbo.shape.slice();\n  x = x | 0;\n  y = y | 0;\n\n  if (typeof radius !== 'number') {\n    radius = 1.0;\n  }\n\n  var x0 = Math.min(Math.max(x - radius, 0), shape[0]) | 0;\n  var x1 = Math.min(Math.max(x + radius, 0), shape[0]) | 0;\n  var y0 = Math.min(Math.max(y - radius, 0), shape[1]) | 0;\n  var y1 = Math.min(Math.max(y + radius, 0), shape[1]) | 0;\n\n  if (x1 <= x0 || y1 <= y0) {\n    return null;\n  }\n\n  var dims = [x1 - x0, y1 - y0];\n  var region = ndarray(this.buffer, [dims[0], dims[1], 4], [4, shape[0] * 4, 1], 4 * (x0 + shape[0] * y0));\n  var closest = selectRange(region.hi(dims[0], dims[1], 1), radius, radius);\n  var dx = closest[0];\n  var dy = closest[1];\n\n  if (dx < 0 || Math.pow(this.radius, 2) < closest[2]) {\n    return null;\n  }\n\n  var c0 = region.get(dx, dy, 0);\n  var c1 = region.get(dx, dy, 1);\n  var c2 = region.get(dx, dy, 2);\n  var c3 = region.get(dx, dy, 3);\n  return new SelectResult(dx + x0 | 0, dy + y0 | 0, c0, [c1, c2, c3], Math.sqrt(closest[2]));\n};\n\nproto.dispose = function () {\n  if (!this.gl) {\n    return;\n  }\n\n  this.fbo.dispose();\n  pool.free(this.buffer);\n  this.gl = null;\n\n  if (this._readTimeout) {\n    clearTimeout(this._readTimeout);\n  }\n};\n\nfunction createSelectBuffer(gl, shape) {\n  var width = shape[0];\n  var height = shape[1];\n  var options = {};\n  var fbo = createFBO(gl, width, height, options);\n  var buffer = pool.mallocUint8(width * height * 4);\n  return new SelectBuffer(gl, fbo, buffer);\n}","map":{"version":3,"sources":["/Users/leena/Downloads/MyProjectDemo/Udacity_Data_Science_Nanodegree_Repo/COVID_India/react_project/react_project/node_modules/gl-select-static/select.js"],"names":["module","exports","createSelectBuffer","createFBO","require","pool","ndarray","cwise","nextPow2","selectRange","args","pre","closestD2","closestX","closestY","body","r","g","b","a","x","y","idx","dx","dy","d2","post","SelectResult","id","value","distance","coord","SelectBuffer","gl","fbo","buffer","_readTimeout","self","_readCallback","bind","readPixels","shape","RGBA","UNSIGNED_BYTE","proto","prototype","Object","defineProperty","get","slice","set","v","c","length","free","mallocUint8","i","begin","clearColor","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","end","bindFramebuffer","FRAMEBUFFER","clearTimeout","setTimeout","query","radius","x0","Math","min","max","x1","y0","y1","dims","region","closest","hi","pow","c0","c1","c2","c3","sqrt","dispose","width","height","options"],"mappings":"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","sourcesContent":["'use strict'\n\nmodule.exports = createSelectBuffer\n\nvar createFBO = require('gl-fbo')\nvar pool      = require('typedarray-pool')\nvar ndarray   = require('ndarray')\nvar cwise     = require('cwise')\nvar nextPow2  = require('bit-twiddle').nextPow2\n\nvar selectRange = cwise({\n  args: [\n      'array',\n      {'offset': [0,0,1], 'array':0},\n      {'offset': [0,0,2], 'array':0},\n      {'offset': [0,0,3], 'array':0},\n      'scalar',\n      'scalar',\n      'index'],\n  pre: function() {\n    this.closestD2 = 1e8\n    this.closestX = -1\n    this.closestY = -1\n  },\n  body: function(r, g, b, a, x, y, idx) {\n    if(r < 255 || g < 255 || b < 255 || a < 255) {\n      var dx = x - idx[0]\n      var dy = y - idx[1]\n      var d2 = dx*dx + dy*dy\n      if(d2 < this.closestD2) {\n        this.closestD2 = d2\n        this.closestX = idx[0]\n        this.closestY = idx[1]\n      }\n    }\n  },\n  post: function() {\n    return [this.closestX, this.closestY, this.closestD2]\n  }\n})\n\nfunction SelectResult(x, y, id, value, distance) {\n  this.coord = [x, y]\n  this.id = id\n  this.value = value\n  this.distance = distance\n}\n\nfunction SelectBuffer(gl, fbo, buffer) {\n  this.gl     = gl\n  this.fbo    = fbo\n  this.buffer = buffer\n  this._readTimeout = null\n  var self = this\n\n  this._readCallback = function() {\n    if(!self.gl) {\n      return\n    }\n    fbo.bind()\n    gl.readPixels(0,0,fbo.shape[0],fbo.shape[1],gl.RGBA,gl.UNSIGNED_BYTE,self.buffer)\n    self._readTimeout = null\n  }\n}\n\nvar proto = SelectBuffer.prototype\n\nObject.defineProperty(proto, 'shape', {\n  get: function() {\n    if(!this.gl) {\n      return [0,0]\n    }\n    return this.fbo.shape.slice()\n  },\n  set: function(v) {\n    if(!this.gl) {\n      return\n    }\n    this.fbo.shape = v\n    var c = this.fbo.shape[0]\n    var r = this.fbo.shape[1]\n    if(r*c*4 > this.buffer.length) {\n      pool.free(this.buffer)\n      var buffer = this.buffer = pool.mallocUint8(nextPow2(r*c*4))\n      for(var i=0; i<r*c*4; ++i) {\n        buffer[i] = 0xff\n      }\n    }\n    return v\n  }\n})\n\nproto.begin = function() {\n  var gl = this.gl\n  var shape = this.shape\n  if(!gl) {\n    return\n  }\n\n  this.fbo.bind()\n  gl.clearColor(1,1,1,1)\n  gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT)\n}\n\nproto.end = function() {\n  var gl = this.gl\n  if(!gl) {\n    return\n  }\n  gl.bindFramebuffer(gl.FRAMEBUFFER, null)\n  if(!this._readTimeout) {\n    clearTimeout(this._readTimeout)\n  }\n  this._readTimeout = setTimeout(this._readCallback, 1)\n}\n\nproto.query = function(x, y, radius) {\n  if(!this.gl) {\n    return null\n  }\n\n  var shape = this.fbo.shape.slice()\n\n  x = x|0\n  y = y|0\n  if(typeof radius !== 'number') {\n    radius = 1.0\n  }\n\n  var x0 = Math.min(Math.max(x - radius, 0), shape[0])|0\n  var x1 = Math.min(Math.max(x + radius, 0), shape[0])|0\n  var y0 = Math.min(Math.max(y - radius, 0), shape[1])|0\n  var y1 = Math.min(Math.max(y + radius, 0), shape[1])|0\n\n  if(x1 <= x0 || y1 <= y0) {\n    return null\n  }\n\n  var dims   = [x1-x0,y1-y0]\n  var region = ndarray(\n    this.buffer,\n    [dims[0], dims[1], 4],\n    [4, shape[0]*4, 1],\n    4*(x0 + shape[0]*y0));\n\n  var closest = selectRange(region.hi(dims[0],dims[1],1), radius, radius)\n  var dx = closest[0]\n  var dy = closest[1]\n  if(dx < 0 || Math.pow(this.radius, 2) < closest[2]) {\n    return null\n  }\n\n  var c0 = region.get(dx, dy, 0)\n  var c1 = region.get(dx, dy, 1)\n  var c2 = region.get(dx, dy, 2)\n  var c3 = region.get(dx, dy, 3)\n\n  return new SelectResult(\n     (dx + x0)|0,\n     (dy + y0)|0,\n     c0,\n     [c1, c2, c3],\n     Math.sqrt(closest[2]))\n}\n\nproto.dispose = function() {\n  if(!this.gl) {\n    return\n  }\n  this.fbo.dispose()\n  pool.free(this.buffer)\n  this.gl = null\n  if(this._readTimeout) {\n    clearTimeout(this._readTimeout)\n  }\n}\n\nfunction createSelectBuffer(gl, shape) {\n  var width = shape[0]\n  var height = shape[1]\n  var options = {}\n  var fbo = createFBO(gl, width, height, options)\n  var buffer = pool.mallocUint8(width*height*4)\n  return new SelectBuffer(gl, fbo, buffer)\n}\n"]},"metadata":{},"sourceType":"script"}